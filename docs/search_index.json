[
["index.html", "Automation of Assessment: Project Overview 1 Abstract", " Automation of Assessment: Project Overview Zachary M. Smith 2020-04-17 1 Abstract The New York State Department of Environmental Conservation’s (NYSDEC’s) Bureau of Water Assessment and Management (BWAM) has made it a top priority to automate waterbody assessments as dictated by NYSDEC’s Consolidated Assessment and Listing Methodology (CALM). For this process to work efficiently, BWAM will need to 1) establish authoritative data repositories and 2) establish a standardized process for applying the assessment process outlined in the CALM. This document details the process for standardizing the assessment logic dictated in the CALM using R statistical software and provides recommendations on the structure and content of data that BWAM should store in their authoritative data repositories. "],
["calm.html", "2 CALM 2.1 Data Modernization", " 2 CALM The NYSDEC maintains a CALM that describes the processes and procedures used to assess the quality of New York’s surface waters and determine the attainment status in each waterbody consistent with applicable water quality standards and guidance values. The following dichotomous key and Figure 2.1 provide two ways of simplifying the assessment process outlined in the CALM. The assessments are used by New York state for management purposes and ultimately reported to the United State Environmental Protection Agency (USEPA) in the form of a 303d list. Dichotomous Key 1a.) The following requirements are NOT met: ELAP certified lab used for analytics (Not applicable until we consider external data sources) Project has an approved QAPP (Not applicable until we consider external data sources) &lt; 10 years old (assessment_period(); within_assess_period == FALSE) Requires manual review 1b.) The above requirements are met (assessment_period(); within_assess_period == TRUE) [2] 2a.) Does not meet the required minimum number of samples or minimum number of years for assessment. (assessment_min_req(); min_req_met == FALSE) [3] 2b.) Meets the required minimum number of samples and minimum number of years for assessment. (assessment_min_req(); min_req_met == TRUE) [5] 3a.) There is a Water Quality Standard violation Classify as Impaired/Unconfirmed IR3 3b.) There is no Water Quality Standard violation [4] 4a.) &gt;= 75% IQR of Water Quality Standard Classify as Stressed/Unconfirmed IR3 4b.) &lt; 75% IWR of Water Quality Standard Classify as Fully Supported/Unconfirmed IR3 5a.) There is a Water Quality Standard violation [7] 5b.) There is no Water Quality Standard violation [6] 6a.) &gt;= 75% IQR of Water Quality Standard Classify as Stressed/Confirmed IR1 6b.) &lt; 75% IWR of Water Quality Standard Classify as Fully Supported/Confirmed IR1 7a.) &gt;= 2 violations over &gt;= 2 years [8] 7b.) &lt; 2 violations over &gt;= 2 years Classify as Impaired/Unconfirmed IR3 8a.) A TMDL exists for the parameter Classify as Impaired/Confirmed IR4 8b.) A TMDL does not exist for the parameter [9] 9a.) A Long Term Consent order or another restoration plan exists Classify as Impaired/Confirmed IR4b 9b.) A Long Term Consent order or another restoration plan do not exist [10] 10a.) The parameter is considered a pollutant Classify as Impaired/Confirmed IR4c 10b.) The parameter is not considered a pollutant Classify as Impaired/Confirmed IR5 Figure 2.1: A decision tree to vizualize the assessment process as defined in the NYSDEC CALM. 2.1 Data Modernization BWAM is piloting the Division of Water’s (DOW’s) Data Modernization effort in partnership with the New York State Office of Information Technology Services (ITS) which will create a robust data workflow for all BWAM related data (Figure 2.2). Progress of the Data Modernization and Automation of Assessment projects are not dependent upon one another, but these projects are not mutually exclusive. The process developed for the Automation of Assessment will ultimately be inserted in the data workflow produced by the Data Modernization project (Figure 2.2). Furthermore, the Data Modernization effort will ultimately produce the authoritative data repositories, in the form of Oracle databases, necessary for automating assessments. No definitive deadline has been establish for the completion of the authoritative Oracle databases; however, the Data Modernization development process has forced the Stream Monitoring and Assessment Section (SMAS), the Lake Monitoring and Assessment Section (LMAS), and the Water Assessment and Implementation Section (WAIS) to begin to compile, re-structure, and re-format their data sets into interim-databases in preparation for the creation of these authoritative Oracle databases. These interim-databases will serve as the current authoritative databases with the expectation that there will be changes to the structure and format of the data once the Oracle databases are finalized, but these changes will be relatively minor. Attempting to align these two efforts as much as possible should ultimately be cost effective, because these two efforts have the potential to be mutually beneficial. Figure 2.2: An overview of New York State Department of Environmental Conservation’s (NYSDEC’s) Bureau of Water Assessment and Management (BWAM) data workflow. The portion of the process surrounded by the red dotted box is most relavent to the automation of assessments. Within the red box are two authoratative database (i.e., the authoratative stream and lake databases) for storing observed water quality variables. Relavent observed values are quired out of these authoratitative databases and processed with an R-script applying CALM logic to assess waterbodies. The assessments produced by the R-script are stored within the authoratative Assessment database, which can be subsequently queried for reporting purposes. "],
["water-quality-standards-and-guidance-values.html", "3 Water Quality Standards and Guidance Values 3.1 Waterbody Class", " 3 Water Quality Standards and Guidance Values Water quality standards (WQSs) and guidance values (GVs) are narrative or numeric criteria for determining the condition of a waterbody. New York State’s (NYS’s) WQSs and GVs are defined in Title 6 NYCRR, Part 703 and TOGS 1.1.1, respectively. WQSs and GVs are applicable to three water types, fresh surface water, saline surface water, and groundwater, as determined by the relationship among WQSs/GVs, WQS/GV-type, best usages, and waterbody class; this chapter will elucidate this relationship as it pertains to numeric-WQSs/GVs used to assess fresh and saline surface waters in NYS. 3.1 Waterbody Class Fresh and saline surface water classes generally conform to a descending alphabetical hierarchy (Figure 3.1). Class D represents the most upstream class of the fresh surface waters, while the various A-classes represent the most downstream classes (Figure 3.1A). Similar to the fresh surface water classes, class SD represents the most upstream class of the saline surface waters, while class SA represents the most downstream class (Figure 3.1B). Class I, within saline surface waters, is downstream of class SC and upstream of class SB, which creates a discrepancy in the descending alphabetical hierarchy of saline surface water classes. Figure 3.1: The standard waterbody class hierarchy of fresh (A) and saline surface waters (B) for which New York State’s water quality standards are inherited in descending alphabetical order. The white-boxes represent the waterbody classes and the arrows indicate the direction that water quality standards are inherited through the class hierarchy. * Fresh surface water classes that have non-trout, trout (T), and trout spawning (TS) variants. WQSs and GVs assigned to upstream classes are inherited by all downstream classes. The most upstream class associated with a WQS or GV will be referred to as the “root” class for a given standard. For example, WQSs and GVs with root D or SD classes will be applicable to all downstream fresh surface water classes (i.e., C, B, A-classes, and their associated Trout (T) and Trout Spawning (TS) variants) and saline surface water classes (i.e., I, SC, SB, and SA), respectively. D and SD represent the most upstream classes in fresh and saline surface waters, respectively, and therefore influence all other classes. However, D and SD classes do not always represent the root class; the root is determined by the designated the type of a WQS or GV and best usage supported. 3.1.1 Designated Best Uses and Standard Types Waterbodies in NYS are assigned designated best use(s) (i.e., Fishing, Secondary Contact Recreation, Primary Contact Recreation, Source Water Supply, and Shellfishing) determined by the waterbody class. Fishing, Primary Contact Recreation, and Secoundary Contact Recreation uses are applicable to fresh and saline surface waters, while the Source Water Supply and Shellfishing uses are only applicable to fresh and saline surface waters, respectively. Figure 3.2 overlays the class hierarchy depicted in Figure 3.1 on the designated best uses the classes support. For example, all fresh surface water class support the Fishing use, while only A-classes support the Source Water Supply use (Figure 3.2A). Furthermore, A-classes support all fresh surface water uses (i.e., Fishing, Secondary Contact Recreation, Primary Contact Recreation, Source Water Supply), while classes C and D only support the fresh surface water Fishing use. To determine the best use supported by a WQS or GV, the WQS- or GV-type must be used as a cross-walk. Figure 3.2: The designated waterbody uses and associated waterbody types of fresh (A) and saline surface waters (B) in New York State overlain with the water quality standards waterbody class hierarchy.The white-boxes represent the waterbody classes and the arrows indicate the direction that water quality standards are inherited through the class hierarchy. * Fresh surface water classes that have non-trout, trout (T), and trout spawning (TS) variants. Title 6 NYCRR, Part 702 defines eight WQS/GV-types that provide an link between a WQS or GV and the best use the standard supports (Table 3.1, Figure 3.2). WQS/GV-types are measurements that are representatitive of a specific aspect of a best usage. For example, Aesthetic (Water Source) standards assess aspects of a source water supply that would be offputting but not harmful (i.e., taste, odor, and discoloration), while Health (Water Source) standards assess the presence of harmful substances in a source water supply. Both types support the source water supply use but represent different components necessary for protecting the use. Table 3.1: The relationship between the best usage and the standard-type. Best.Use Type Source Fishing Aquatic (Acute) Title 6 NYCRR, Part 702.9 Fishing Aquatic (Chronic) Title 6 NYCRR, Part 702.9 Fishing Health (Fish Consumption) Title 6 NYCRR, Part 702.8 Fishing Wildlife Title 6 NYCRR, Part 702.13 Fishing Aesthetic (Food Source) Title 6 NYCRR, Part 702.14 Secondary Contact Recreation Recreation Title 6 NYCRR, Part 702.12 Primary Contact Recreation Recreation Title 6 NYCRR, Part 702.12 Source Water Supply Health (Water Source) Title 6 NYCRR, Part 702.2 Source Water Supply Aesthetic (Water Source) Title 6 NYCRR, Part 702.14 Shellfishing Not Applicable Not Applicable In practice, the types specified in the WQS or GV tables in Title 6 NYCRR, Part 703 and TOGS 1.1.1 must be utilized to cross-walk the WQSs and GVs in these tables to the best use(s) supported. When multiple WQS-types are listed for a single parameter, Title 6 NYCRR, Part 703.5 Health (Fish Consumption), 2) Aquatic (Chronic), 3) Aquatic (Acute), and 4) Wildlife. Therefore, there are four standards for assessing the fishing use (i.e., Health (Fish Consumption), Aquatic (Chronic), Aquatic (Acute), and Wildlife types). For all fresh and saline surface water classes the Health (Fish Consumption) standard is the most stringent, rendering the remaining types irrelavent and unapplicable to any assessment. WQS/GV-types provide a link between most WQSs/GVs and the use supported, but not all standards are assigned a type. Many of the WQSs defined outside of Title 6 NYCRR, Part 703.5 do not have defined WQS/GV-types, and therefore support all designated best uses associated with a given class. For example, the dissolved oxygen (DO) WQS defined in Title 6 NYCRR, Part 703.3 has no defined type for fresh surface water classes. If DO is used to assess a class C waterbody, the assessment will only support the Fishing use. While, if DO is used to assess a class A waterbody, the assessment will support Fishing, Secondary Contact Recreation, Primary Contact Recreation, and Source Water Supply uses. The generic application of WQSs or GVs to best usages when types are absent provides no direct relationship between the standard and the best usage. Although most WQSs and GVs adhere to the logic represented in Figure 3.2, there are multiple discrepancies in Title 6 NYCRR, Part 703 and TOGS 1.1.1. 3.1.2 Discrepancies The following WQS do not follow the logic depicted in Figure 3.2. It is important to specifically document all discrepancies as these instances will require special attention during the development of an automated assessment process. 3.1.2.1 Class I In TOGS 1.1.1 Part 1A-Section 3. Water Classes and Type, WQSs for the saline surface water class I are associated with types Health (Consumption of Fish), Aquatic (Chronic), Aquatic (Acute), Wildlife Protection, and Aesthetic– “Aesthetic” should most likely represent “Aesthetic (Food Source)” to align with the types defined in Title 6 NYCRR, Part 703.5). However, in Table 1 of TOGS 1.1.1 and in Title 6 NYCRR, Part 703.5, class I water’s are frequently and inconsistently excluded from the above mentioned types. This creates a class hierarchy that follows the logic in Figure 3.3 rather than the logic in Figure 3.1. Figure 3.3: In some instances New York State saline surface water standards exclude class I from the hierarchy of class. The white-boxes represent the waterbody classes and the arrows indicate the direction that water quality standards are inherited through the class hierarchy. The red-box indicates that the waterbody class has been excluded from the hierarchy. 3.1.2.2 Aquatic (Acute) Aquatic (Acute) designates a type of WQS or GV. Title 6 NYCRR, Part 702.9d states: “Where the waters are to be suitable for fish, shellfish and wildlife propagation and survival, both Aquatic (Chronic) and Aquatic (Acute) standards or guidance values shall apply.” However, the class hierarchy associated with Aquatic (Acute) WQSs are treated inconsistently in Title 6 NYCRR, Part 703.5 and TOGS 1.1.1. In many instances, the class hierarchy follows the rules depicted in Figure 3.1, but there are multiple instances where Aquatic (Acute) WQSs and GVs are only applicable to fresh and saline surface water classes D and SD, respectively (Figure 3.4). Figure 3.4: Many water quality standards of type Aquatic (Acute) are only applicable for fresh and saline surface waters D and SD, respectively. Therefore, Aquatic (Acute) standards are not always inherited by the classes downstream of D and SD in their respective hierarchies. There is no standardized logic dictating when Aquatic (Acute) water quality standards are or are not inherited by their descendants. Table 3.2 is a modified version of the table in Title 6 NYCRR, Part 703.5 subset to only include parameters associated with type Aquatic Acute; Aquatic Chronic types were also retained when they corresponded with an Aquatic Acute standard for a given parameter. In fresh surface waters the Aquatic Acute WQSs for un-ionized ammonia as NH3, benzidine, and carbofuran are only applicable to class D waters. While in saline surface waters arsenic, cadmium, hexavalent chromium, and cyanide are only applicable to class SD waters. Endosulfan and total residual chlorine were only applicable to classes D and SD within fresh and saline surface waters, respectively. In all instances described, the Aquatic Acute standards are superseded by more stringent Aquatic Chronic standards for all classes downstream in the hierarchy– except when class I’s are missing (see Class I). There are also instances in Table 3.2 where the entire class hierarchy is specified for the Aquatic Acute type (e.g., fresh surface water arsenic and saline surface water Copper). This creates an odd discrepancy for assessments. For example, the arsenic fresh surface water Aquatic Acute and Aquatic Chronic standards are applicable to classes C, B, A, A-Special, AA, and AA-Special. Conversely, the arsenic saline surface water Aquatic Acute standard is only applicable to class SD waters, while the Aquatic Chronic standard is applicable to classes SC, SB, and SA. Thus, a class A waterbody would be assessed for both Aquatic Acute and Aquatic Chronic standards, while the most downstream saline class, class SA, would only be assessed by the Aquatic Chronic standard. Table 3.2: All Aquatic (Acute) water quality standards in Title 6 NYCRR, Part 703.5. Aquatic (Chronic) water quality standards were included, if they were present for any of the same parameters that also had an Aquatic (Acute) standard. parameter cas_no class standard units type remark Ammonia and Ammonium 7664-41-7; NA A, A-S, AA, AA-S, B, C NA ug/L A(C) Un-ionized ammonia as NH3; tables below provide the standard in ug/L at varying pH and temperature for different classes and specifications. Linear interpolation between the listed pH values and temperatures is applicable. Ammonia and Ammonium 7664-41-7; NA D NA ug/L A(A) Un-ionized ammonia as NH3; tables below provide the standard in ug/L at varying pH and temperature for different classes and specifications. Linear interpolation between the listed pH values and temperatures is applicable. Ammonia and Ammonium 7664-41-7; NA SA, SB, SC, I 3.5e+01 ug/L A(C) Applies to un-ionized ammonia as NH3. Ammonia and Ammonium 7664-41-7; NA SA, SB, SC, I, SD 2.3e+02 ug/L A(A) Applies to un-ionized ammonia as NH3. Arsenic NA A, A-S, AA, AA-S, B, C 1.5e+02 ug/L A(C) Dissolved arsenic form. Arsenic NA A, A-S, AA, AA-S, B, C, D 3.4e+02 ug/L A(A) Dissolved arsenic form. Arsenic NA SA, SB, SC 6.3e+01 ug/L A(C) Dissolved arsenic form. Arsenic NA SD 1.2e+02 ug/L A(A) Dissolved arsenic form. Azinphosmethyl 86-50-0 A, A-S, AA, AA-S, B, C 5.0e-03 ug/L A(C) For the waters of the Great Lakes System, the department will substitute a guidance value for the aquatic Type standard if so determined under section 702.15(c) of this Title. Azinphosmethyl 86-50-0 SA, SB, SC 1.0e-02 ug/L A(C) NA Benzidine 92-87-5 A, A-S, AA, AA-S, B, C 1.0e-01 ug/L A(C) For the waters of the Great Lakes System, the department will substitute a guidance value for the aquatic Type standard if so determined under section 702.15(c) and (d) of this Title. Benzidine 92-87-5 D 1.0e-01 ug/L A(A) For the waters of the Great Lakes System, the department will substitute a guidance value for the aquatic Type standard if so determined under section 702.15(c) and (d) of this Title. Cadmium NA A, A-S, AA, AA-S, B, C NA ug/L A(C) (0.85) exp(0.7852 [ln (ppm hardness)] - 2.715) Cadmium NA A, A-S, AA, AA-S, B, C, D NA ug/L A(A) (0.85) exp(1.128 [ln (ppm hardness)] - 3.6867) Cadmium NA SA, SB, SC, I 7.7e+00 ug/L A(C) NA Cadmium NA SD 2.1e+01 ug/L A(A) NA Carbofuran 1563-66-2 A, A-S, AA, AA-S, B, C 1.0e+00 ug/L A(C) For the waters of the Great Lakes System, the department will substitute a guidance value for the aquatic Type standard if so determined under section 702.15(c) and (d) of this Title. Carbofuran 1563-66-2 D 1.0e+01 ug/L A(A) For the waters of the Great Lakes System, the department will substitute a guidance value for the aquatic Type standard if so determined under section 702.15(c) and (d) of this Title. Chlorine, Total Residual NA A, A-S, AA, AA-S, B, C 5.0e+00 ug/L A(C) NA Chlorine, Total Residual NA D 1.9e+01 ug/L A(A) NA Chlorine, Total Residual NA SA, SB, SC, I 7.5e+00 ug/L A(C) NA Chlorine, Total Residual NA SD 1.3e+01 ug/L A(A) NA Chromium NA A, A-S, AA, AA-S, B, C NA ug/L A(C) (0.86) exp(0.819 [ln (ppm hardness)] + 0.6848) Chromium NA A, A-S, AA, AA-S, B, C, D NA ug/L A(A) (0.316) exp(0.819 [ln (ppm hardness)] + 3.7256) Chromium (hexavalent) NA A, A-S, AA, AA-S, B, C 1.1e+01 ug/L A(C) Applies to dissolved form. Chromium (hexavalent) NA A, A-S, AA, AA-S, B, C, D 1.6e+01 ug/L A(A) Applies to dissolved form. Chromium (hexavalent) NA SA, SB, SC 5.4e+01 ug/L A(C) Applies to acid-soluble form. Chromium (hexavalent) NA SD 1.2e+03 ug/L A(A) Applies to acid-soluble form. Copper NA A, A-S, AA, AA-S, B, C NA ug/L A(C) (0.96) exp(0.8545 [ln (ppm hardness)] - 1.702) Copper NA A, A-S, AA, AA-S, B, C, D NA ug/L A(A) (0.96) exp(0.9422 [ln (ppm hardness)] - 1.7) Copper NA SA, SB, SC, I NA ug/L A(C) Standard is 3.4 ug/L except in New York/New Jersey harbor where it is 5.6 ug/L. Copper NA SA, SB, SC, I, SD NA ug/L A(A) Standard is 4.8 ug/L except in New York/New Jersey harbor where it is 7.9 ug/L. Cyanide NA A, A-S, AA, AA-S, B, C 5.2e+00 ug/L A(C) As free cyanide: the sum of HCN and CN− expressed as CN. Cyanide NA A, A-S, AA, AA-S, B, C, D 2.2e+01 ug/L A(A) As free cyanide: the sum of HCN and CN− expressed as CN. Cyanide NA SA, SB, SC 1.0e+00 ug/L A(C) As free cyanide: the sum of HCN and CN− expressed as CN. Cyanide NA SD 1.0e+00 ug/L A(A) As free cyanide: the sum of HCN and CN− expressed as CN. Dieldrin 60-57-1 A, A-S, AA, AA-S, B, C 5.6e-02 ug/L A(C) NA Dieldrin 60-57-1 A, A-S, AA, AA-S, B, C, D 2.4e-01 ug/L A(A) NA Endosulfan 115-29-7 A, A-S, AA, AA-S, B, C 9.0e-03 ug/L A(C) NA Endosulfan 115-29-7 D 2.2e-01 ug/L A(A) For the waters of the Great Lakes System, the department will substitute a guidance value for the aquatic Type standard if so determined under section 702.15(d) of this Title. Endosulfan 115-29-7 SA, SB, SC 1.0e-03 ug/L A(C) NA Endosulfan 115-29-7 SD 3.4e-02 ug/L A(A) NA 3.1.2.3 Chlorobenzene Chlorobenzene (108-90-7)… 3.1.2.4 Trout and Trout Spawning Waters Fresh surface water classes C, B, A, A-Special, AA, and AA-Special have variants designating Trout (T) and Trout Spawning (TS) waterbodies (e.g., C(T) and C(TS)). For the majority of parameters, these variants have the same WQS as the non-T/TS waterbody classes (Figure 3.1). Dissolved oxygen and ammonia as NH3 WQS differ between non-T/TS, T, and TS waterbody class variants (Figure 3.5); non-T/TS variants have the least stringent standards, while TS variants have the most stringent standards. These parameters do not have an assigned WQS/GV-type, therefore Figure 3.5: New York State’s fresh surface water dissolved oxygen and ammonia as NH3 water quality standards for class C, B, A, A-Special, AA, and AA-Special differ among non-Trout, Trout (T), and Trout Spawning (TS) class variants. 3.1.2.5 Class A Variants Most fresh surface water class A variants have the same WQSs or GVs, but there are several instances where not all class A variants have defined standards or the standard deviates from the standard for the rest of the A variants. 3.1.2.5.1 Dissolved Solids The dissolved solids A-Special WQS (200 mg/L) is more stringent than the other A variants (500 mg/L; Title 6 NYCRR, Part 703.3). 3.1.2.5.2 Total and Fecal Coliforms The WQSs for total and fecal coliforms in fresh surface waters follow the logic dictated in Figure 3.1, except there is no total coliform standard applicable to class AA-Special and there are no fecal coliform standards applicable to class AA or AA-Special Title 6 NYCRR, Part 703.4. "],
["staycalm.html", "4 stayCALM 4.1 R Programming Language 4.2 Process Overveiw 4.3 Expected Data Structure 4.4 Data Preprocessing 4.5 Current Status", " 4 stayCALM The R package, stayCALM (Standardized Tool for Applying Your Consolidated Assessment and Listing Methodology), provides a robust framework for automating assessments as outlined in the NYSDEC CALM. The intent is to provide a tool that enforces a strict standardized process, but is flexible enough to quickly and accurately accommodate changes to the CALM. 4.1 R Programming Language The programming language, R, was selected because it provides an excellent environment for developing and executing standardized computations and processes. 4.2 Process Overveiw There are two methods for applying the logic defined in the CALM– both of which could be supported by the functions provided in stayCALM: The CALM process could be strictly followed by dividing the data at each node of the decision tree depicted in Figure 1 until each data point has been appropriately assessed. The various subsets created during this process would be appended together to create the final assessment product. Pros: No unnecessary calculations are made. Cons: The process creates many disperate datasets, which… makes it difficult comprehend how the data is being handled at each step; leaves room for the introduction of errors, such as accidentally dropping a subset of data or applying the wrong process to a subset of data; and future modifications to the CALM may require an extensive re-structuring of flow through the decision tree (Figure 1). All intermittent steps from the CALM process could be applied globally to the data set, and subsequently the assessment classifications can be assigned. Pros: The process does not divide the data into multiple subsets, which… makes it simple to follow the process; reduces the chance of introducting errors; and will require minimal reconfiguration if the CALM process is updated in the future. Cons: Potentially slower than other methodologies because unnecessary calculations are made. The time added by these unnecessary calculations is likely to be neglible for the data set sizes assessed by NYSDEC. Additionally, the potential time lag would likely be on the order of seconds or minutes; this is far faster than a manual effort to perform assessments for a large amount of data, which would likely be on the order of days, weeks, or months. 4.3 Expected Data Structure Data should be stored in a long-format where each row represents a single parameter value collected during a sampling event. stayCALM::stream 4.4 Data Preprocessing Data Preprocessing Assessment Database Water Quality Thresholds tlkParam = a table that includes water quality standards associated with waterbody class and parameter. tlkParam_75p_long = a table that includes 75th percentile thresholds associated with waterbody class and parameter. These tables need to be expanded to include every combination of trout (T) and trout spawning (TS) designations. NEED: build a function to prepare T and TS designations. NEED: to export these tables and add them to the Assessment Database. The following tables from the Assessment database need to be joined tblWIPWL tblkCOUNTY (by = “COUNTY”) tlkDRAIN_BASIN (by = “SUBBASIN_CODE”) tlk305B (by = “TYPE”) tlkTYPE (by = “X305B_CODE”) tlkParam (as prepared above) tlkParam_75p_long (as prepared above) Alter: change the order that these occur in the script. tlkParam tables should be prepared first, and then the other Assessment database tables should be imported, joined, and joined with the tlkParam tables. Chemistry Data correction_param_prep() = parameters used as correction factors (e.g., hardness, pH, and temperature) are extracted from the parameter-name and parameter-value columns and represented as a unique column. This prepares the data frame for the correction factors to be applied to the appropriate parameter values. The correction parameters, when available, will be joined with all parameters collected during the same sampling event, NOT just the parameters that require correction. This global join simplifies the preprocessing steps and reduces the chance of introducing errors. ISSUE: pH is creating duplicates Join the prepared Assessment tables with the prepared Chemistry tables by = c(\"SEG_ID\" = \"SH_PWL_ID\", \"parameter\" = \"CHEMICAL_NAME\") date_standard_cols() = adds various date related columns to the data frame that will simplify the assessment process. datetime date year month preprocess_validation() = ensures that the data validation column only includes the expected character strings and filters out rows that represent “Not Reported”. Review: how does this handle NAs? assessment_id() = uses dplyr group_indicies() to generate a unique assessment ID based on unique instances of the columns supplied to the ellipse argument (...). assessment_id the name of the column added to the data frame representing the unique assessment ID. assessment_period() = allows for the specification of the assessment period by number of years from the current date. For example, the default value is 10-years (n_years_ago = 10), and therefore the sampling period would include all samples from 10-years from the present date to the present date. asssess_period the name of the column added to the data frame, which will specify “within_assessment_period” or “outside_assessment_period”. These designations will dictate how the data is assessed via the CALM. assessment_min_counts() = allows for the specification of the minimum number of samples required per a designated group (e.g., assessment_id) to perform an assessment. n_samples = a column representing the total number of samples per designated group. min_n_samples = a column containing logical values indicating if there are enough samples available to perform an assessment. These designations will dictate how the data is assessed via the CALM. assessment_min_years() = allows for the specification of the minimum number of years required to perform an assessment. This is different from assessment_period(). assessment_period() designates the extent of the time period within_assess_period = a logical column indicating if the samples were collected within the designated sampling period (TRUE) or not (FALSE). assessment_min_req() = wraps around assessment_min_counts() and assessment_min_years() to perform these calculations with a single call and provides a flag indicating if the minimum requirements from both functions were met. min_req_met = a column indicating if the minimum number of samples and minimum number of sampling years are met (min_n_samples == TRUE &amp; min_n_years == TRUE). The values in this column will represent logical values (TRUE or FALSE). Questioning: should assessment period be included in this call and update the min_req_met column? No, these should remain separate 4.5 Current Status To Do Create a general function for assessing both WQS and &gt; 75% IQR of WQS Create a classification function that uses case_when to look at all prepped columns "],
["methods.html", "5 Methods 5.1 stayCALM Package Installation 5.2 Prepare the R Environment 5.3 Preprocess Data 5.4 Assess", " 5 Methods 5.1 stayCALM Package Installation You can install the development version from GitHub with: # install.packages(&quot;devtools&quot;) devtools::install_github(&quot;BWAM/stayCALM&quot;) You must have rtools installed on your machine for the stayCALM to be built upon installation from GitHub. rtools is NOT an R package. On Windows machines, rtools can be installed from the following CRAN repository: https://cran.r-project.org/bin/windows/Rtools/. 5.2 Prepare the R Environment Load the necessary R packages into the global environment, including the stayCALM package. library(tidyverse) library(stayCALM) 5.3 Preprocess Data 5.3.1 Water Quality Standards Data was preprocessed to resemble the expected output from the athorotative databases that will become available as part of the Data Modernization effort Data Modernization. data(nysdec_wqs) fresh - fresh surface waters D &gt; C &gt; B &gt; A &gt; A-Special &gt; AA &gt; AA-Special D &gt; C &gt; C(T) &gt; C(TS) &gt; B &gt; B(T) &gt; B(TS) &gt; A &gt; A(T) &gt; A(TS) &gt; A-Special &gt; A-Special(T) &gt; A-Special(TS) &gt; AA &gt; AA(T) &gt; AA(TS) &gt; AA-Special &gt; AA-Special(T) &gt; AA-Special(TS) saline - saline surface waters SD &gt; I &gt; SC &gt; SB &gt; SA wqs.df &lt;- purrr::map_df(c(&quot;fresh&quot;, &quot;saline&quot;, &quot;saline_i&quot;), function(type.i) { class.vec &lt;- switch(type.i, &quot;fresh&quot; = c(&quot;D&quot;, class_variants(.class_vec = c(&quot;C&quot;, &quot;B&quot;, &quot;A&quot;, &quot;A-Special&quot;, &quot;AA&quot;, &quot;AA-Special&quot;), .variant_vec = c(&quot;&quot;, &quot;(T)&quot;, &quot;(TS)&quot;))), &quot;saline&quot; = c(&quot;SD&quot;, &quot;I&quot;, &quot;SC&quot;, &quot;SB&quot;, &quot;SA&quot;)) #&quot;saline_i&quot; = &quot;I&quot;) wqs_sub.df &lt;- nysdec_wqs[nysdec_wqs$class_type == type.i, ] final.df &lt;- class_inheritance(.data = wqs_sub.df, parameter, .class_col = class, .levels_vec = class.vec) %&gt;% dplyr::mutate(class = as.character(class)) }) 5.3.2 WI/PWL Data was preprocessed to resemble the expected output from the athorotative databases that will become available as part of the Data Modernization effort Data Modernization. data(&quot;wipwl.df&quot;) wqs_wipwl.df &lt;- wipwl.df %&gt;% select(seg_id, class, tmdl_id, mgmtstat) %&gt;% distinct() %&gt;% left_join(wqs.df, by = &quot;class&quot;) 5.3.3 Stream Data Data was preprocessed to resemble the expected output from the athorotative databases that will become available as part of the Data Modernization effort Data Modernization. data(stream_chem.df) chem.df &lt;- stream_chem.df %&gt;% rename_all(tolower) %&gt;% rename(seg_id = sh_pwl_id, parameter = chemical_name) %&gt;% inner_join(wqs_wipwl.df, by = c(&quot;seg_id&quot;, &quot;parameter&quot;)) chem_final.df &lt;- chem.df %&gt;% mutate(result_numeric = if_else(is.na(result_numeric) &amp; !is.na(validation_level), reporting_detection_limit, result_numeric)) %&gt;% filter(!validation_level %in% &quot;Not Reported&quot;, !is.na(result_numeric)) 5.4 Assess Thresholds represented by NA will throw an error. The majority of the NAs in the threshold column now need to be calculated– a task I have not standardized yet. chem_final.df &lt;- chem_final.df %&gt;% filter(!is.na(threshold)) assessed.df &lt;- chem_final.df %&gt;% # Drop this filter after additional prep steps have been added filter(is.na(formula) &amp; statistic %in% &quot;none&quot; &amp; block %in% &quot;single&quot;) %&gt;% date_standard_cols(.date_col = sample_date) %&gt;% assessment_id(seg_id, lab_anl_method_name, cas_rn, parameter) %&gt;% mutate(within_period = assessment_period(.date_vec = date, .n_years_ago = 10), attaining_wqs = wqs_attaining(result_numeric, direction, threshold, na.rm = TRUE), attaining_75 = wqs_attaining(result_numeric, direction, threshold, na.rm = TRUE)) %&gt;% group_by(assessment_id, within_period) %&gt;% summarize( wqs_violation = any(attaining_wqs == FALSE), wqs_75_violation = any(attaining_75 == FALSE), min_years_samples = length(unique(year)) &gt;= 2 &amp; length(assessment_id) &gt;= 8, min_violations_year = sum(tapply(attaining_wqs == FALSE, year, sum) &gt; 0), tmdl = FALSE, ltco_rest_plan = FALSE, pollutant = FALSE ) test.df &lt;- assessed.df %&gt;% mutate( assessment = case_when( !within_period ~ &quot;Manual Review Required: Manual Review Required: Manual Review Required&quot;, !min_years_samples &amp; wqs_violation ~ &quot;IR3: Impaired: Unconfirmed&quot;, !min_years_samples &amp; !wqs_violation &amp; wqs_75_violation ~ &quot;IR3: Fully Supported: Unconfirmed&quot;, !min_years_samples &amp; !wqs_violation &amp; !wqs_75_violation ~ &quot;IR3: Stressed: Unconfirmed&quot;, min_years_samples &amp; wqs_violation &amp; wqs_75_violation ~ &quot;IR1: Fully Supported: Confirmed&quot;, min_years_samples &amp; wqs_violation &amp; !wqs_75_violation ~ &quot;IR1: Stressed: Confirmed&quot;, min_years_samples &amp; !wqs_violation &amp; !min_violations_year ~ &quot;IR3: Impaired: Unconfirmed&quot;, min_years_samples &amp; !wqs_violation &amp; min_violations_year &amp; tmdl ~ &quot;IR4a: Impaired: Confirmed&quot;, min_years_samples &amp; !wqs_violation &amp; min_violations_year &amp; !tmdl &amp; ltco_rest_plan ~ &quot;IR4b: Impaired: Unconfirmed&quot;, min_years_samples &amp; !wqs_violation &amp; min_violations_year &amp; !tmdl &amp; !ltco_rest_plan &amp; pollutant ~ &quot;IR4c: Impaired: Confirmed&quot;, min_years_samples &amp; !wqs_violation &amp; min_violations_year &amp; !tmdl &amp; !ltco_rest_plan &amp; !pollutant ~ &quot;IR5: Impaired: Confirmed&quot;, TRUE ~ &quot;ERROR&quot; ) ) # table(test.df$assessment) "],
["results.html", "6 Results", " 6 Results "],
["discussion.html", "7 Discussion", " 7 Discussion "],
["appendix-a.html", "8 Appendix A 8.1 Part 701 Classifications: Surface Waters and Groundwaters 8.2 Part 702 Derivation and Use of Standards and Guidance Values 8.3 Part 703 Surface Water and Groundwater Quality Standards and Groundwater Effluent Limitations", " 8 Appendix A Appendix A appends together sections of 6 CRR-NY Parts 701-703 that are most applicable to the application of surface and saline surface water water quality standards (WQSs) and guidance values (GVs). The majority of this appendix represents the exact language, demarcated by the block quotes, from the section referenced. The text from each section may NOT represent all of the text from the section because text was specifically extracted if it was deemed to be absolutely necessary to understand the relationship between WQSs/GVs, classes, types, and best usages. 8.1 Part 701 Classifications: Surface Waters and Groundwaters 8.1.1 Fresh Surface Water Classes 8.1.1.1 Class D The best usage of Class D waters is fishing. Due to such natural conditions as intermittency of flow, water conditions not conducive to propagation of game fishery, or stream bed conditions, the waters will not support fish propagation. These waters shall be suitable for fish, shellfish and wildlife survival. The water quality shall be suitable for primary and secondary contact recreation, although other factors may limit the use for these purposes. – 6 CRR-NY 701.9 8.1.1.2 Class C The best usage of Class C waters is fishing. These waters shall be suitable for fish, shellfish and wildlife propagation and survival. The water quality shall be suitable for primary and secondary contact recreation, although other factors may limit the use for these purposes. - 6 CRR-NY 701.8 8.1.1.3 Class B The best usages of Class B waters are primary and secondary contact recreation and fishing. These waters shall be suitable for fish, shellfish and wildlife propagation and survival. - 6 CRR-NY 701.7 8.1.1.4 Class A The best usages of Class A waters are: a source of water supply for drinking, culinary or food processing purposes; primary and secondary contact recreation; and fishing. The waters shall be suitable for fish, shellfish and wildlife propagation and survival. - 6 CRR-NY 701.6 8.1.1.5 Class A-Special The best usages of Class A-S waters are: a source of water supply for drinking, culinary or food processing purposes; primary and secondary contact recreation; and fishing. The waters shall be suitable for fish, shellfish and wildlife propagation and survival. - 6 CRR-NY 701.4 8.1.1.6 Class AA The best usages of Class AA waters are: a source of water supply for drinking, culinary or food processing purposes; primary and secondary contact recreation; and fishing. The waters shall be suitable for fish, shellfish and wildlife propagation and survival. - 6 CRR-NY 701.5 8.1.1.7 Class AA-Special The best usages of Class AA-S waters are: a source of water supply for drinking, culinary or food processing purposes; primary and secondary contact recreation; and fishing. The waters shall be suitable for fish, shellfish and wildlife propagation and survival. - 6 CRR-NY 701.3 8.1.1.8 Class N (a) The best usages of Class N waters are the enjoyment of water in its natural condition and, where compatible, as a source of water for drinking or culinary purposes, bathing, fishing, fish propagation, and recreation. The waters shall be suitable for shellfish and wildlife propagation and survival and fish survival. - 6 CRR-NY 701.2 8.1.2 Saline Surface Water Classes 8.1.2.1 Class SD The best usage of Class SD waters is fishing. These waters shall be suitable for fish, shellfish and wildlife survival. In addition, the water quality shall be suitable for primary and secondary contact recreation, although other factors may limit the use for these purposes. This classification may be given to those waters that, because of natural or man-made conditions, cannot meet the requirements for fish propagation. - 6 CRR-NY 701.14 8.1.2.2 Class SC The best usage of Class SC waters is fishing. These waters shall be suitable for fish, shellfish and wildlife propagation and survival. The water quality shall be suitable for primary and secondary contact recreation, although other factors may limit the use for these purposes. - 6 CRR-NY 701.12 8.1.2.3 Class I The best usages of Class I waters are secondary contact recreation and fishing. These waters shall be suitable for fish, shellfish, and wildlife propagation and survival. In addition, the water quality shall be suitable for primary contact recreation, although other factors may limit the use for this purpose. - 6 CRR-NY 701.13 8.1.2.4 Class SB The best usages of Class SB waters are primary and secondary contact recreation and fishing. These waters shall be suitable for fish, shellfish and wildlife propagation and survival. - 6 CRR-NY 701.11 8.1.2.5 Class SA The best usages of Class SA waters are shellfishing for market purposes, primary and secondary contact recreation and fishing. These waters shall be suitable for fish, shellfish and wildlife propagation and survival. - 6 CRR-NY 701.10 8.2 Part 702 Derivation and Use of Standards and Guidance Values 8.2.1 702.1 Basis for derivation of water quality standards and guidance values The control of taste-, color- and odor-producing, toxic and other deleterious substances is implemented through the use of standards and guidance values. Standards and guidance values for such substances shall be derived according to the procedures set forth in this Part. The derivation of standards and guidance values will consider, to the extent possible, variations in natural or background conditions of waters, including but not limited to alkalinity, temperature, hardness and pH. Standards and guidance values shall be of the following Types to protect the best usages of the waters as described in Part 701 of this Title: Health (Water Source) or H(WS); Health (Fish Consumption) or H(FC); Aquatic (Chronic) or A(C); Aquatic (Acute) or A(A); Wildlife or W; Aesthetic (Water Source) or E(WS); Aesthetic (Food Source) or E(FS); and Recreation or R. - 6 CRR-NY 702.1 8.2.2 702.2 Standards and guidance values for protection of human health and sources of potable water supplies Standards and guidance values for protection of the best usage as a source of potable water supply shall protect human health and drinking water sources and are referred to as Health (Water Source) values. - 6 CRR-NY 702.2 8.2.3 702.8 Procedures for deriving standards and guidance values for protection of human health from consumption of fish Standards and guidance values for the protection of the best usage of fishing shall protect the health of human consumers of fish and, for Class SA waters, human consumers of shellfish from chemicals that may bioaccumulate and are referred to as Health (Fish Consumption) values. - 6 CRR-NY 702.8 8.2.4 702.9 Standards and guidance values for protection of aquatic life Protection of the best usage of fishing shall include standards and guidance values for the protection of aquatic life. Standards and guidance values for the protection of propagation of aquatic life are referred to as Aquatic (Chronic) values. Standards and guidance values for the protection of survival of aquatic life are referred to as Aquatic (Acute) values. Where the waters are to be suitable for fish, shellfish and wildlife propagation and survival, both Aquatic (Chronic) and Aquatic (Acute) standards or guidance values shall apply. Where the waters are to be suitable for fish, shellfish and wildlife survival, Aquatic (Acute) standards and guidance values shall apply. 8.2.5 702.12 Procedures for deriving standards and guidance values for protection of recreation Protection of the best usage of recreation shall include standards and guidance values to protect the quality of the water for primary and secondary contact recreation, including aesthetic conditions. Such values are referred to as recreation values and derived based on an evaluation of reported levels of the pollutant (such as pathogens or pathogen indicators, nutrients or vegetation) that affect the quality of the water and its suitability for primary and secondary contact recreation. - 6 CRR-NY 702.12 8.2.6 702.13 Procedures for deriving standards and guidance values for protection of wildlife Protection of the best usage of fishing shall include standards and guidance values for protection of the health of wildlife consumers of aquatic life and water. Such values are referred to as Wildlife values. - 6 CRR-NY 702.13 8.2.7 702.14 Procedures for deriving standards and guidance values for protection of aesthetic quality Protection of the best usage as a source of potable water supply shall include standards and guidance values to protect the aesthetic quality of the water, including but not limited to taste, odor, and discoloration, both as a source of potable water and for other human uses such as clothes washing and showering. Such values are referred to as Aesthetic (Water Source) values and shall be derived based on an evaluation of reported levels of the substance that affect the aesthetic quality of the water. Values derived shall not exceed the value of a Specific MCL that is based on aesthetic considerations. Protection of the best usage of fishing shall include standards and guidance values to prevent tainting of aquatic food, including but not limited to taste, odor, and discoloration. Such values are referred to as Aesthetic (Food Source) values and derived based on an evaluation of reported levels of the substance that affect the aesthetic quality of the fish flesh, aquatic life, wildlife, or livestock that are consumed by humans and that acquire such flavor, odor, or color because of habitation in, passage through, or ingestion of waters. - 6 CRR-NY 702.14 8.2.8 702.15 Derivation of guidance values For those substances that do not have an applicable Health (Water Source) standard in section 703.5 of this Title and that the department determines may pose a threat to human health if discharged to the waters of the State, a guidance value may be derived and shall be the most stringent of the following: the values derived by applying the procedures from sections 702.3 through 702.7 of this Part; a “general organic guidance value” of 50 ug/L for an individual organic substance. This paragraph does not apply if adequate and sufficient data are available to justify values greater than 50 ug/L using procedures from both sections 702.4 and 702.5 of this Part. The general organic guidance value applies only to those substances specified by the department; or a “specific organic mixture guidance value” of 100 ug/L for a commercially available mixture of individual organic substances. This paragraph does not apply if adequate and sufficient data are available to justify values greater than 100 ug/L using procedures from both sections 702.4 and 702.5 of this Part. The derivation of this value for any specified mixture does not preclude the existence or derivation of a Health (Water Source) standard or guidance value for any individual organic substance in the mixture. The specific organic mixture guidance value applies only to those mixtures specified by the department. For those substances that do not have an applicable Health (Fish Consumption) standard in section 703.5 of this Title and that the department determines may pose a threat to human health if discharged to the waters of the State, a guidance value may be derived by applying the procedures from section 702.8 of this Part. For those substances that do not have an applicable Aquatic (Chronic) standard in section 703.5 of this Title and that the department determines may pose a threat to aquatic life or the environment if discharged to the waters of the State, a guidance value may be derived by applying the appropriate procedure from section 702.9 of this Part. For those substances that have an identified applicable Aquatic (Chronic) standard in section 703.5 of this Title, a guidance value shall be substituted where the procedures in section 702.9 of this Part yield a more stringent value. Remarks in Table 1 of section 703.5(f) of this Title identify the standards to which this paragraph applies. This paragraph applies only to the waters of the Great Lakes System. For those substances that do not have an applicable Aquatic (Acute) standard in section 703.5 of this Title and that the department determines may pose a threat to aquatic life or the environment if discharged to the waters of the State, a guidance value may be derived by applying the appropriate procedure from section 702.9 of this Part. For those substances that have an identified applicable Aquatic (Acute) standard in section 703.5 of this Title, a guidance value shall be substituted where the procedures in section 702.9 of this Part yield a more stringent value. Remarks in Table 1 of section 703.5(f) of this Title identify the standards to which this paragraph applies. This paragraph applies only to the waters of the Great Lakes System. For those substances that do not have an applicable Wildlife standard in section 703.5 of this Title and that the department determines may pose a threat to wildlife if discharged to the waters of the State, a guidance value may be derived by applying the appropriate procedure from section 702.13 of this Part. For those substances that do not have an applicable Aesthetic (Water Source) standard in section 703.5 of this Title and that the department determines may pose a threat to the aesthetic quality of sources of potable water if discharged to the waters of the State, a guidance value may be derived by applying the appropriate procedure from section 702.14 of this Part. For those substances that do not have an applicable Aesthetic (Food Source) standard in section 703.5 of this Title and that the department determines may pose a threat to the aesthetic quality of food for human consumption if discharged to the waters of the State, a guidance value may be derived by applying the appropriate procedure from section 702.14 of this Part. For those parameters that do not have an applicable Recreation standard in section 703.5 of this Title and that the department determines may pose a threat to the quality of the water for recreation if discharged to the waters of the State, a guidance value may be derived by applying the appropriate procedure from section 702.12 of this Part. - 6 CRR-NY 702.15 8.3 Part 703 Surface Water and Groundwater Quality Standards and Groundwater Effluent Limitations 8.3.1 703.5 Water quality standards for taste-, color- and odor-producing, toxic and other deleterious substances Standards are Health (Water Source), Health (Fish Consumption), Aquatic (Chronic), Aquatic (Acute), Wildlife, Aesthetic (Water Source), Aesthetic (Food Source), or Recreation based and are respectively designated as H(WS), H(FC), A(C), A(A), W, E(WS), E(FS), or R in the column headed “Type.” Where more than one Type of standard is listed for a water class, the most stringent applies. - 6 CRR-NY 703.5 "]
]
